generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Route {
  id          String   @id @default(cuid())
  origin      String
  destination String
  originName  String
  destName    String
  provider    Provider
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  prices      Price[]

  @@unique([origin, destination, provider])
  @@index([active])
}

model Price {
  id                String   @id @default(cuid())
  routeId           String
  departureAt       DateTime
  trainNumber       String
  trainType         String
  price             Decimal  @db.Decimal(10, 2)
  class             String
  duration          Int?
  availableSeats    Int?     // Seats available for this class/offer
  totalAvailable    Int?     // Total seats available across all classes
  scrapedAt         DateTime @default(now())
  route             Route    @relation(fields: [routeId], references: [id], onDelete: Cascade)

  @@index([routeId, departureAt])
  @@index([scrapedAt])
  @@index([routeId, scrapedAt])
}

enum Provider {
  TRENITALIA
  ITALO
}
